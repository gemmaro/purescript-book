# はじめに

## 関数型JavaScript

関数型プログラミングの手法がJavaScriptに姿を現しはじめてからしばらく経ちます。

- [UnderscoreJS](https://underscorejs.org)などのライブラリがあれば、
  開発者は`map`や `filter`、
  `reduce`といった実績のある関数を活用して、
  小さいプログラムを組み合わせることで大きなプログラムを作ることができます。

    ```javascript
    var sumOfPrimes =
        _.chain(_.range(1000))
         .filter(isPrime)
         .reduce(function(x, y) {
             return x + y;
         })
         .value();
    ```

- NodeJSにおける非同期プログラミングでは、第一級の値としての関数をコールバックを定義するために多用しています。

    ```javascript
    import { readFile, writeFile } from 'fs'

    readFile(sourceFile, function (error, data) {
      if (!error) {
        writeFile(destFile, data, function (error) {
          if (!error) {
            console.log("File copied");
          }
        });
      }
    });
    ```

- [React](https://reactjs.org)や
  [virtual-dom](https://github.com/Matt-Esch/virtual-dom)などのライブラリは、
  アプリケーションの状態についての純粋な関数としてその外観をモデル化しています。

関数は単純な抽象化を可能にし、優れた生産性をもたらしてくれます。
しかし、JavaScriptでの関数型プログラミングには欠点があります。
JavaScriptは冗長で、型付けされず、強力な抽象化を欠いているのです。
また、無秩序に書かれたJavaScriptコードでは、等式推論がとても困難です。

PureScriptはこのような問題を解決すべく作られたプログラミング言語です。
PureScriptは、とても表現力豊かでありながらわかりやすく読みやすいコードを書けるようにする、
軽量な構文を備えています。
強力な抽象化を提供する豊かな型システムも採用しています。
また、JavaScriptやJavaScriptへとコンパイルされる他の言語と相互運用するときに重要な、
高速で理解しやすいコードを生成します。
PureScriptをひとことで言えば、純粋関数型プログラミングの理論的な強力さと、
JavaScriptのお手軽で緩いプログラミングスタイルとの、
とても現実的なバランスを狙った言語だということを理解して頂けたらと思います。

## 型と型推論

動的型付けの言語と静的型付けの言語をめぐる議論についてはよく知られています。
PureScriptは**静的型付け**の言語、
つまり正しいプログラムはコンパイラによってその動作を示すような**型**を与えられる言語です。
逆にいえば、型を​​与えることができないプログラムは**誤ったプログラム**であり、
コンパイラによって拒否されます。
動的型付けの言語とは異なり、
PureScriptでは型は**コンパイル時**のみに存在し、
実行時には型の表現はありません。

PureScriptの型は、これまでJavaやC#のような他の言語で見たような型とは、
いろいろな意味で異なっていることにも注意することが大切です。
おおまかに言えばPureScriptの型はJavaやC#と同じ目的を持っているものの、
PureScriptの型はMLとHaskellのような言語に影響を受けています。
開発者がプログラムについての強い主張を表明できるので、PureScriptの型は表現力豊かなのです。
最も重要なのは、PureScriptの型システムは**型推論**(type inference)をサポートしていることです。
型推論があれば他の言語より遥かに少ない型注釈で住み、
型システムを厄介者ではなく**道具**にしてくれます。
簡単な例を示すと、次のコードは**数**を定義していますが、
それが `Number`型だという注釈はコードのどこにもありません。

```haskell
iAmANumber =
  let square x = x * x
  in square 42.0
```

次のもっと複雑な例では、
**コンパイラにとって未知**の型が存在しているときでさえも、
型注釈なしで型の正しさを確かめることができるということが示されています。

```haskell
iterate f 0 x = x
iterate f n x = iterate f (n - 1) (f x)
```

ここで `x`の型は不明ですが、
`x`がどんな型を持っているかにかかわらず、
`iterate`が型システムの規則に従っていることをコンパイラは検証することができます。

本書で納得していただきたい（または既にお持ちの信条に寄り添って改めて断言したい）ことは、
静的型が単にプログラムの正しさに自信を持つためだけのものではなく、
それ自身の正しさによって開発の手助けになるものでもあるということです。
JavaScriptではごく単純な抽象化を施すのでも大規模なコードのリファクタリングをすることは難しいですが、
型検証器のある表現力豊かな型システムは、
リファクタリングさえ楽しく対話的な体験にしてくれます。

加えて、型システムによって提供されるこのセーフティネットは、
より高度な抽象化をも可能にします。
実際に、関数型プログラミング言語Haskellによって知られるようになった、
型駆動の強力な抽象化の形式である『型クラス』をPureScriptは備えています。

## 多言語Webプログラミング

関数型プログラミングはすでに多くの成功を収めています。
枚挙に暇がありませんが、特に成功している応用例をいくつか挙げると、
データ解析、構文解析、コンパイラの実装、ジェネリックプログラミング、並列処理などがあります。

PureScriptのような関数型言語は、
アプリケーション開発の最初から最後までを​実施することが可能です。
値や関数の型を提供することで既存のJavaScriptコードをインポートし、
通常のPureScriptコードからこれらの関数を使用する機能をPureScriptは提供しています。
この手法については本書の後半で見ていくことになります。

しかしながら、PureScriptの強みのひとつは、JavaScriptを対象とする他​​の言語との相互運用性にあります。アプリケーションの開発の一部にだけPureScriptを使用し、JavaScriptの残りの部分を記述するのに他の言語を使用するという方法もあります。

いくつかの例を示します。

- 中核となる処理はPureScriptで記述し、
  ユーザーインターフェイスはJavaScriptで記述する
- JavaScriptや、他のJavaScriptにコンパイルされる言語でアプリケーションを書き、
  PureScriptでそのテストを書く
- 既存のアプリケーションのユーザインタフェースのテストを自動化するためにPureScriptを使用する

この本では小規模な課題をPureScriptで解決することに焦点を当てます。
ここで学ぶ手法は大規模なアプリケーションに組み込むこともできますが、
これについてはJavaScriptからPureScriptコードを呼び出す方法、およびその逆についても見ていきます。

## ソフトウェア要件

この本でのソフトウェア要件は最小限です。
第1章では開発環境の構築を一から案内します。
これから使用するツールは、ほとんどの現代のオペレーティングシステムの標準リポジトリで使用できるものです。

PureScriptコンパイラ自体はバイナリ形式でダウンロードすることもできますし、
最新のHaskellコンパイラが稼働しているシステム上でソースからビルドすることもできます。
次の章ではこの手順を説明していきます。

本書のこのバージョンのコードは`0.15.*`バージョンのPureScriptコンパイラと互換性があります。

## 読者について

読者はJavaScriptの基本をすでに理解しているものと仮定します。
すでにNPMやBowerのようなJavaScriptのエコシステムでの経験があれば、
自身の好みに応じて標準設定をカスタマイズしたい場合などに役に立ちます。
ですが、そのような知識は必須ではありません。

関数型プログラミングの予備知識は必要ありませんが、
あっても害にはならないでしょう。
新しい考えかたは実例とともに登場するので、
これから使う関数型プログラミングからこうした概念に対する直感的な理解を得ることができるはずです。

PureScriptはプログラミング言語Haskellに強く影響を受けているため、Haskellに通じている読者はこの本の中で提示された概念や構文の多くに見覚えがあるでしょう。しかしながら、読者はPureScriptとHaskellの間にはいくつか重要な違いがあることも理解しておかなければなりません。ここで紹介する概念の多くはHaskellでも同じように解釈できるとはいえ、どちらかの言語での考え方を他方の言語でそのまま応用しようとすることは、必ずしも適切ではありません。

## 本書の読み進めかた

本書の各章は、概ね章ごとに完結しています。
しかしながら、多少の関数型プログラミングの経験がある初心者でも、
まずは各章を順番に進めていくことをおすすめします。
最初の数章では、本書の後半の内容を理解するために必要な基礎知識を養います。
関数型プログラミングの考え方に十分通じた読者
（特にMLやHaskellのよう強く型付けされた言語での経験を持つ読者）なら、
本書の前半の章を読まなくても、後半の章のコードの大まかな理解を得ることがおそらく可能でしょう。

各章ではそれぞれひとつの実用的な例に焦点をあて、新しい考え方を導入するための動機付けとして用います。
各章のコードは本書の[GitHubのリポジトリ](https://github.com/purescript-contrib/purescript-book)から入手できます。
ソースコードから抜粋したコード片が掲載されている章もありますが、完全に理解するためには本書に掲載されたコードと平行してリポジトリのソースコードを読む必要があります。
対話式環境PSCiで実行し理解を確かめられるように、長めの節には短いコード片が掲載されていることがあります。

コード例は次のように等幅フォントで示されています。

```haskell
module Example where

import Effect.Console (log)

main = log "Hello, World!"
```

先頭にドル記号がついた行は、コマンドラインに入力されたコマンドです。

```text
$ spago build
```

通常、これらのコマンドはLinuxやMac
OSの利用者ならそのまま適用できますが、Windowsの利用者はファイル区切り文字を変更する、シェルの組み込み機能をWindowsの相当するものに置き換えるなどの小さな変更を加える必要があるかもしれません。

PSCi対話式モードプロンプトに入力するコマンドは、行の先頭に山括弧が付けられています。

```text
> 1 + 2
3
```

各章には演習が付いており、それぞれ難易度も示されています。各章の内容を完全に理解するために、演習に取り組むことを強くお勧めします。

この本は初心者にPureScriptへの導入を提供することを目的としており、問題についてのお決まりの解決策の一覧を提供するような種類の本ではありません。初心者にとってこの本を読むのは楽しい挑戦になるはずですし、本書の内容を読み演習に挑戦すればだいたいの利益を得られるでしょうが、なにより重要なのは、あなたが自分自身のコードを書いてみることです。

## 困ったときには

もしどこかでつまずいたときには、PureScriptを学べるオンラインで利用可能な資料がたくさんあります。

- [PureScriptのDiscordサーバ](https://discord.gg/vKn9up84bp)は抱えている
  問題についてチャットするのに良い場所です。
  サーバはPureScriptについてのチャット専用です。
- [PurescriptのDiscourseフォーラム](https://discourse.purescript.org/)も
  よくある問題への解決策を探すのに良い場所です。
  メッセージ履歴が約2週間しか保たないSlackとは違い、
  ここで質問した内容は将来の読者の助けとして使えるでしょう。
- [PureScript: Jordan's
Reference](https://github.com/jordanmartinez/purescript-jordans-reference)
  は別のかなり深く踏み込んだ学習資料です。
  この本の中のある概念が理解しにくかったら、
  そちらの参考書の対応する節を読むとよいでしょう。
- [Pursuit](https://pursuit.purescript.org)
  はPureScriptの型と関数を検索できるデータベースです。
  Pursuitのヘルプページを読むと
  [どのような種類の検索ができるのかがわかります](https://pursuit.purescript.org/help/users)。
- 非公式の[PureScript
Cookbook](https://github.com/JordanMartinez/purescript-cookbook)は
  「Xするにはどうするの？」といった類の質問にコードを混じえて答えを提供します。
- [PureScriptドキュメントリポジトリ](https://github.com/purescript/documentation)には、
  PureScriptの開発者や利用者が書いた幅広い話題の記事と例が集まっています。
- [PureScriptのWebサイト](https://www.purescript.org)には、
  コード例、映像、他の初心者向け資料を含むいくつかの学習資料へのリンクがあります。
- [Try PureScript!](https://try.purescript.org)は
  利用者がWebブラウザでPureScriptのコードをコンパイルすることができるWebサイトです。
  いくつかの簡単なコードの例があります。

もしあなたが例を読んで学ぶことを好むなら、GitHubの `purescript`組織、 `purescript-node`組織および
`purescript-contrib`組織にはPureScriptコードの例がたくさんあります。

## 著者について

私はPureScriptコンパイラの最初の開発者です。私はカリフォルニア州ロサンゼルスを拠点にしており、8ビットパーソナルコンピュータ、Amstrad
CPC上のBASICでまだ幼い時にプログラミングを始めました。
それ以来、私はいくつものプログラミング言語（JavaやScala、C#、F#、Haskell、そしてPureScript）で業務に携わってきました。

プロとしての経歴が始まって間もなく、私は関数型プログラミングと数学の関係を理解するようになり、
そしてプログラミング言語Haskellを使って関数型の概念の学習を楽しみました。

JavaScriptでの経験をもとに、私はPureScriptコンパイラの開発を始めることにしました。
気が付くとHaskellのような言語から取り上げた関数型プログラミングの手法を使っていましたが、それを応用するためのもっと理にかなった環境を求めていました。
そのとき検討した案のなかには、Haskellからその意味論を維持しながらJavaScriptへとコンパイルするいろいろな試み（Fay、Haste、GHCJS）もありましたが、私が興味を持っていたのは、この問題への別の切り口からのアプローチ、すなわちHaskellのような言語の構文と型システムを楽しみながらJavaScriptの意味論も維持するということが、どのようにすれば可能になるのかでした。

私は[ブログ](http://blog.functorial.com)を運営しており、[Twitterで連絡をとる](http://twitter.com/paf31)こともできます。

## 謝辞

現在の状態に到達するまでPureScriptを手伝ってくれた多くの協力者に感謝したいと思います。コンパイラやツール、ライブラリ、ドキュメント、テストでの組織的で弛まぬ努力がなかったら、プロジェクトは間違いなく失敗していたことでしょう。

この本の表紙に表示されたPureScriptのロゴはGareth Hughesによって作成されたもので、[Creative Commons
Attribution 4.0
license](https://creativecommons.org/licenses/by/4.0/)の条件の下で再利用させて頂いています 。

最後に、この本の内容に関する反応や訂正をくださったすべての方に、心より感謝したいと思います。

- - -

この翻訳は[@aratama](https://github.com/aratama)氏による翻訳を元に改変を加えています。
翻訳リポジトリは[`aratama/purescript-book-ja`](https://github.com/aratama/purescript-book-ja)に、Webサイトは[実例によるPureScript](http://aratama.github.io/purescript/)にあります。
ライセンスは[クリエイティブコモンズ 表示 - 非営利 - 継承 3.0 非移植ライセンス](http://creativecommons.org/licenses/by-nc-sa/3.0/deed.ja)にしたがいます。